# Address Resolution Protocol
RFC826で定義されている、宛先のMACアドレスを知るための規約。

略してARP、アープと読む。そのままアドレス解決プロトコルとのこと。

簡単にいうと、IPアドレスがわかった時点であなたのMACアドレス教えて〜と聞く規約。

## ARPテーブル
IPアドレスとMACアドレスの対応表のことで、ARPキャッシュともいう。

これがあればARPのリクエストは送らなくてもOKになる。

```
local-mesh1neko:~$ arp -a
aterm.me (192.168.10.1) at c0:xx:xx:xx:a:xx on en0 ifscope [ethernet]
? (192.168.10.9) at 0:xx:xx:xx:xx:xx on en0 ifscope [ethernet]
? (192.168.10.255) at (incomplete) on en0 ifscope [ethernet]
? (192.168.99.255) at (incomplete) on vboxnet0 ifscope [ethernet] # これはたぶんdokcerかな？
```

ARPにも動的と静的な設定方法が存在する。

## ARP要求とARP応答
ARPテーブルに情報がない場合に、MACアドレスを知りたい！と要求を出します。

このとき、ARPパケットを使ったARP専用のパケットで通信を行う（IPではない）

### ARPパケット
上位レイヤーからのデータは入らないため、ARPのためのデータにイーサネットヘッダとトレーラをつけてフレームとして送信する。

### ARP要求から応答までの流れ
 1. ARPテーブルを参照して対応するMACアドレスがないか確認する
 1. ない場合、ARP要求を「ブロードキャスト」する！（あれば終わり）
 1. ARP要求を受け取った各ホストは、宛先のIPが自分かどうか判定して
  1. 一致しない　→　破棄
  1. 一致する　　→　ARP応答を返す
 1. ARP要求を受け取ったホストは、得られたMACアドレスを追加する

なお、ARP要求を受け取ったホストは送信元のMACアドレスを自身のARPテーブルに保持しておく。（あとから自分がARPしなくて済む）

これはブロードキャストがスイッチやブリッジでフィルタされないため、

帯域幅を圧迫されかねないという状態（ブロードキャスト・ストーム）を避けるためです。

### 通常通りではARP要求が届かないパターン
ルータはブロードキャストをフィルタリングしてしまうため、

ルータの先のネットワークのホストに対してARPが届きません。

この場合はデフォルトゲートウェイを利用していいがにするらしい。
