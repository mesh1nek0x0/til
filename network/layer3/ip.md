# layer3 ip
internet protocolの略

インターネットで使用されるプロトコルの１つ。論理アドレスの決定と経路の決定を行いパケット転送の役割を受け持つ。

転送方法はベストエフォート型で転送についての保障は行わない。

TCP/IPとセットで紹介されるが、それぞれ別々のプロトコルです。

このような複数のプロトコルを１つの思想としてまとめたものをプロトコルスイートやプロトコルスタックと呼ぶようです。

スイートというのはテストスイートとかもあるし、馴染みありますね。

※他のlayer3 プロトコルについて
TCP/IP以外でよく知られているのはIPX/SPXやAppleTalkなどがある。


## IPヘッダ
セグメントデータにヘッダデータ(20~60byte)を付与する。フレームにつけたヘッダ・トレーラのようなトレーラは存在しない。

ヘッダは20byte+オプション40byteで構成され、最初の20byte=160bitで重要のなのは以下の３つが大事。

### TTL
Time To Liveの略。パケットの生存時間。永遠にパケットがぐるぐるするのを防ぐ仕組み。

### 送信元IPアドレス
送信元の論理アドレス(32bit)

### 送信先IPアドレス
宛先の論理アドレス(32bit)

その他見かけそうなヘッダの中身

* バージョン
 * v4とかv6かな
* ヘッダチェックサム
 * IPヘッダのエラーチェック

## 論理アドレス
いわゆるIPアドレスがこれの１つにあたる。

ベンダが発行したあと変更できない物理アドレスと異なり、ネットワーク管理者が自由に付け替えらるのが特徴。

各デバイスとネットワークの接続点ごとに付与する。

tips. NICを差し替えても同じIPを割り当てることは可能なので、NICごとではない

プロトコルによって論理アドレスの体系が変わるため、プロトコルが違う場合は変換が必要になる。

* IP(TCP/IP)
 * 192.168.33.100
* IPX(IPX/SPX)
 * 4d.0060.3e86.e220
* DDP(AppleTalk)
 * 151.10

### 論理アドレスの構成
ネットワークアドレス＋ホスト番号という構成になっている。

管理するネットワークの大きさによって32bitのうちどこまでをネットワークアドレス、どこからをホスト番号にするという形で決める。

これは何処の誰？を明確にするためであり、「何処」は接続されているネットワーク内でユニークである必要があります。

※接続されていなければ、ユニークでなくも問題ない

## IPアドレス
IPで使われるアドレスなのでIPアドレス。単純。

MACアドレスは48bitでしたが、IPアドレス（v4）は32bitです。v6になると128bitまで拡張されるようです。

ただ、人間にはとても読みにくいため、8bitごとに4つに区切って（4つのオクテット）10進数で表記する。

## ICANN
とても大きいネットワークであるインターネットの管理団体。The Internet Corporation for Assigned Names and Numbersの略称。

インターネットの資源であるIPアドレスやドメイン名について管理ポリシーを策定している。

ただし、実際は国や地域ごとにInternet Network Center(NIC)が存在して分散して管理している。

IPアドレスをクラスという概念で管理して（きた）。日本はJPNICが管理している。

## クラスフルアドレッシング
ネットワークの規模に応じてクラスA~Eまでをふり分ける。ただし、DとEは特別で普通は割り当てられない。

クラスは実際、32bitのうちどこまでをネットワーク番号にするのか。という範囲を表している。

* A
 * 第１オクテットの最初が0
 * 0.x.x.x~127.x.x.x
 * 政府、国家機関、大企業
* B
 * 第１オクテットの最初が10
 * 128.x.x.x~191.x.x.x
 * 中規模企業
* C
 * 第１オクテットの最初110
 * 192.x.x.x~223.x.x.x
 * 小規模企業・プロバイダ
* D
 * 第１オクテットの最初が1110
 * 224.x.x.x~239.x.x.x
* E
 * 第１オクテットの最初が1111
 * 240.x.x.x~255.x.x.x

ちなみに割り当てるのはネットワーク番号だけで、ホスト番号はネットワーク番号を割り当ててもらった管理者が割振る。

## 予約済みアドレス

ホスト番号を割振るにあたって、割り当てることができない予約済みアドレスが２つ存在する。

そのため、各ネットワークで保持できるホストは最大値-2となる。

### ネットワークアドレス
ホスト部がビットが全部0のアドレスのことです。当該のネットワークそのものを意味する。

### ブロードキャストアドレス
ホスト部のビットが全部1のアドレスのことです。ネットワークのホスト全員が受け取るアドレスです。

### ループバックアドレス
127番ネットワークはICANNやNICからは割り当てられないネットワーク、いわゆるローカルホスト(127.0.0.1)というやつです。

### プライベートアドレス（制限ブロードキャストアドレス）
255.255.255.255というすべてのネットワークに対するブロードキャストアドレスが存在する。ただし、インターネットには接続されない。

### プライベートIPアドレス
ネットワークに直接接続することなく、NATを使って接続するLANが使う専用のIPアドレス。

インターネットに直接接続はしない、ということでICANNやNICが割り当てることはなく、万が一接続できる状態になっても

ルーターが流さないようになっているらしい。

* クラスA
 * 10.x.x.x
* クラスB
 * 172.16~31.x.x
* クラスC
 * 192.168.0~255.x

こうやってみると納得ですよね...今まで知らなかったなんて...。

### グローバルIPアドレス
プライベートIPアドレスと異なり、NICから割り当てられたインターネットに接続できるIPアドレス。

## サブネットワーク
大きなネットワークをいくつかの小さなネットワークに分割して管理しやすくする考え方。

普通に考えて必要だよね。クラスAの場合ホストがホスト番号が24bitということで

2^24-2...16,777,214...1700万台のホスト管理なんて物理的に現実的ではないからです、ええ。

### サブネットワークの仕組み
NICから割り当てられたネットワーク番号とホスト番号のうちこちら自由に割り当てできるホスト番号の頭の方を

サブネット番号とすることで別のネットワークとして切り出します。イメージは以下の通り。

```
サブネット前：　| ネットワーク番号 |　　　　　ホスト番号　　　　　|
サブネット後：　| ネットワーク番号 | サブネット番号 | ホスト番号 |
```

注意したい点としては10進法表記に騙されないこと。

クラスBのプライベートIPとして、サブネット番号に6bitを割り当てたとします。

サブネット一番は000001となるわけですが、この場合IPアドレス全体をみると

３オクテット目が00000100で10進数表記だと4になるので172.16.4.xという形になります。

このサブネットのホスト1番は172.16.4.1となりますが、決してサブネット4番の1番ホストではないのです！
