# DHCPについて
IPアドレスの動的割り当てに使われるプロトコルです。

Dynamic Hots Configuration Protocolの略だそうです。

RFC2131, RFC3132で定義されているそうです。

MACの場合

```
/var/db/dhcpclient/leases/
```

配下にリースされているIPアドレスの情報があります、へー。

IPアドレスが欲しい　：DHCPクライアント
IPアドレスを貸し出す：DHCPサーバ

おうちだとルータがDHCPサーバの役割もしていそうですね。

## IPアドレスプール
コネクションプールみたいな名前が出てきましたが、名前の通り割り当てできるIPアドレスのプールです。

そもそものホスト数もありますが、サーバ側でここからここまでと割り当てる範囲を決めるられるようです。柔軟でいいね。

## リース期限
実は割り当て...という名の貸し出しでした！というオチ。プールから使っていないものを割振ることになるので、

ノートPCみたいにすぐ移動できるノードの場合、実はもうそのPCはこのネットワークにはないよ〜と状況もおこりやすいです。

DHCPサーバの方では状況がわからず、無駄が発生しています。そうならないように一定期間で返却してね！というのリース期限です。

クライアントは継続して使用したい場合は延長を申し出る形になります。

## DHCPメッセージ
DHCPサーバへ送信するデータにはいろいろあるが大事なのは以下の3つ。

* クライアントIPアドレス
 * 4byte
 * 再リース時のみ
* 割り当てIPアドレス
 * 4byte
 * サーバが割り当てたアドレス
* オプション
 * バイト数可変
 * クライアントのその他設定情報

### DHCPメッセージ
IPアドレスの要求をする際にやりとりで使われるメッセージのことで、いくつか種類があります。

* DHCPDISCOVER
 * DHCPサーバどこー？
 * ブロードキャストで送信する
 * 宛先はIP/MAC:255.255.255.255/FFFF.FFFF.FFFF.FFFF
 * 送信元IPアドレスはわからないため0.0.0.0
* DHCPOFFER
 * DHCPサーバからこのIPどう？という申し出。
 * まだIPが決まっていないためこれもブロードキャストで送る
* DHCPREQUEST
 * クライアントからの決定要求
 * まだIPが決まっていないためこれもブロードキャストで送る
 * オプションに要求するIPが入っている
 * リースの延長要求にも使われる
* DHCPACK
 * ACK（aknowledge：認めます）という意味
 * オプションにホストの設定であるサブネットマスクなどが入っている
 * まだIPが決まっていないためこれもブロードキャストで送る
* DHCPNACK
 * Not ACK, 認めませんという意味
* DHCPRELEASE
 * クライアントからサーバへのリリースの要求です。
