# スレッドの設定周り
## スレッド数
同時接続数とも例えられる。

* スレッドの数だけ、攻撃拠点ができるイメージ
* 攻撃は始めないけど、試験開始時には一気に作られるため注意
  * 数値を大きくすると負荷をかけるクラインアントのリソースがやばい

## ループ回数
各スレッドごとにサンプラー（HTTPリクエスト）を何回実行するのか？

* ループは終わり次第、すぐ次のループが始まることに注意

## Ramp-Up期間について
攻撃開始のタイミングの設定。

* 各スレッド（攻撃拠点）の攻撃タイミングの間隔を調整
* 攻撃はスレッドの総数をこのRamp-Up期間で除算し、均等な間隔で攻撃を開始
* 他の設定項目の中でもイマイチパッと理解できない代表

# 設定例
## 攻撃パターンA
* スレッド数:1
* ループ回数:10
* Ramp-Up期間:1
---
* この場合攻撃に使われるのは1拠点だけ
* 1拠点から10発サンプラー（攻撃）が飛ぶ
* 攻撃は1秒間間隔ですが、1拠点だけなので特に意味はない

全体では1秒で10発の攻撃が来ているので、10req/sec

## 設定パターンB
* スレッド数:10
* ループ回数:1
* Ramp-Up期間:10
---
* この場合攻撃に使われるのは10拠点
* 10拠点からそれぞれ1発のサンプラー（攻撃）が飛ぶ
* 攻撃は10秒の間に、10拠点から均等な間隔で攻撃を開始(10/10=1秒間隔)

全体では10秒で10発の攻撃が来ているので、1req/sec

## 設定パターンC
* スレッド数:5
* ループ回数:10
* Ramp-Up期間:10
---
* この場合攻撃に使われるのは5拠点
* 5拠点からそれぞれ10発のサンプラー（攻撃）が飛ぶ
* 攻撃は10秒の間に、5拠点から均等な間隔で攻撃を開始(10/5=2秒間隔)

全体では10秒で50発の攻撃が来ているので、5req/sec...

と思うが、そんなグラフにはならないので注意。ログをよく見てみよう。

### Ramp-Upとループ回数の罠
ループは直前のループが終わったらすぐ次が実行されるため、
パターンCの場合、一度攻撃を開始すると各スレッドは10発撃ち切ってしまう。2秒間で均等に10発撃たれる訳ではないので注意されたし。

```
# パターンCで実行するとこんな感じの表ができる
23:14:02.834    スレッドグループ 1-1
23:14:02.848    スレッドグループ 1-1
23:14:02.859    スレッドグループ 1-1
23:14:02.870    スレッドグループ 1-1
23:14:02.886    スレッドグループ 1-1
23:14:02.897    スレッドグループ 1-1
23:14:02.902    スレッドグループ 1-1
23:14:02.908    スレッドグループ 1-1
23:14:02.919    スレッドグループ 1-1
23:14:02.924    スレッドグループ 1-1
23:14:04.836    スレッドグループ 1-2
23:14:04.840    スレッドグループ 1-2
23:14:04.842    スレッドグループ 1-2
23:14:04.849    スレッドグループ 1-2
23:14:04.854    スレッドグループ 1-2
23:14:04.863    スレッドグループ 1-2
23:14:04.866    スレッドグループ 1-2
23:14:04.871    スレッドグループ 1-2
23:14:04.887    スレッドグループ 1-2
23:14:04.900    スレッドグループ 1-2
```

* スレッドグループ1-1とスレッドグループ1-2の開始は2秒ほど空いているので想定通り
* 1-1の開始から1-1の終了まではわずが0.07秒程度
* 1-2の開始から1-2の終了まではわずが0.07秒程度

2秒ごとにスレッドは起動しているけど、
5req/secかというと全体平均ではそうだけど、細部を見るとそうでもない。2秒台にリクエストが集中している。

// ちゃんとグラフで可視化してしてみたかったけど...
// Kibana周りの学習が済んだら連携させてみよう
